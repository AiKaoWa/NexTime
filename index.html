<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Calendar with Gear Icon</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            position: relative;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            font-family: 'Ubuntu', Arial, sans-serif;
        }
        /* New big header styles */
        .big-header {
            position: fixed; /* Use fixed positioning to stay at the top */
            top: 0; /* Align to the top of the viewport */
            left: 50%; /* Center horizontally */
            transform: translateX(-50%) translateY(-70px); /* Offset by half of its own width */
            text-align: center; /* Center text inside the header */
            padding: 100px 0;
            border-radius: 8px;
            z-index: 1;
        }
        .big-header h1 {
            font-size: 8em; /* Adjust font size */
            margin: 0;
            line-height: 1.2;
        }
        .dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }
        .container {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            margin: 20px;
        }
        .calendar {
            width: 100%;
            max-width: 390px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 13px;
            box-sizing: border-box;
            font-family: 'Ubuntu', Arial, sans-serif;
            font-size: 1.3em;
            background-color: #fff;
            transition: background-color 0.3s, border-color 0.3s;
            position: absolute; /* Position absolute for the note box */
            z-index: 1000;
        }
        .dark-mode .calendar {
            background-color: #333;
            border-color: #444;
        }
        .calendar h2 {
            text-align: center;
            margin: 0;
            padding: 13px 0;
            border-bottom: 1px solid #ddd;
        }
        .dark-mode .calendar h2 {
            border-color: #444;
        }
        .calendar .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 13px;
        }
        .calendar .controls button {
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 13px;
            cursor: pointer;
            font-size: 1.3em;
            width: 52px;
            height: 39px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .dark-mode .calendar .controls button {
            background-color: #444;
            border-color: #555;
            color: #e0e0e0;
        }
        .calendar .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
        }
        .calendar .day {
            text-align: center;
            padding: 10px 0;
            box-sizing: border-box;
            border: 1px solid #ddd;
            background-color: #fff;
            font-size: 0.8em;
        }
        .dark-mode .calendar .day {
            background-color: #444;
            border-color: #555;
        }
        .calendar .day-header {
            color: black;
            font-weight: bold;
            padding: 13px 0;
            font-size: 0.8em;
        }
        .dark-mode .calendar .day-header {
            color: #e0e0e0;
        }
        .calendar .day-header.sun {
            background-color: rgba(255, 0, 0, 0.3); /* Red */
        }
        .calendar .day-header.mon {
            background-color: rgba(255, 255, 0, 0.3); /* Yellow */
        }
        .calendar .day-header.tue {
            background-color: rgba(233, 41, 201, 0.3); /* Pink */
        }
        .calendar .day-header.wed {
            background-color: rgba(0, 128, 0, 0.3); /* Green */
        }
        .calendar .day-header.thu {
            background-color: rgba(255, 165, 0, 0.3); /* Orange */
        }
        .calendar .day-header.fri {
            background-color: rgba(7, 124, 192, 0.3); /* Cyan */
        }
        .calendar .day-header.sat {
            background-color: rgba(110, 8, 168, 0.3); /* Purple */
        }
        .calendar .day.current-date {
            color: #0329ff; /* Blue text color for the current date */
            font-weight: bold;
            border: 2px solid #0329ff; /* Blue border for the current date */
            border-radius: 4px; /* Slightly rounded corners */
            padding: 5px; /* Add padding to create space between text and border */
            display: flex; /* Use flexbox for centering */
            align-items: center; /* Vertically center text */
            justify-content: center; /* Horizontally center text */
            height: 100%; /* Ensure the height matches the box */
        }
        .dark-mode .calendar .day.current-date {
            color: #4658f3; /* Lighter blue text color for dark mode */
            border: 2px solid #4658f3; /* Lighter blue border for dark mode */
        }
        .gear {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-size: 2em;
            cursor: pointer;
            z-index: 1000;
        }
        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px; /* Start off-screen */
            width: 300px;
            height: 100%;
            background-color: #fff;
            border-left: 1px solid #ddd;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.3);
            padding: 20px;
            box-sizing: border-box;
            z-index: 1000;
            overflow-y: auto;
            transition: right 0.3s ease;
        }
        .dark-mode .settings-panel {
            background-color: #333;
            border-color: #444;
        }
        .settings-panel.active {
            right: 0; /* Slide in */
        }
        .settings-panel .close {
            font-size: 1.5em;
            cursor: pointer;
            color: #333;
            display: block;
            margin-bottom: 20px;
        }
        .dark-mode .settings-panel .close {
            color: #e0e0e0;
        }
        .settings-panel label {
            display: block;
            margin-bottom: 10px;
        }
        .drag-handle {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 10px;
            background-color: #ddd;
            cursor: move;
            z-index: 1100; /* Ensure it's above the calendar */
        }
        .dark-mode .drag-handle {
            background-color: #555;
        }
        .note-box {
            width: 250px;
            max-height: 400px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-left: 20px; /* Space between calendar and note box */
            box-sizing: border-box;
            position: absolute; /* Position absolute for the calendar */
        }
        .dark-mode .note-box {
            background-color: #444;
            border-color: #555;
        }
        .note-box h3 {
            margin-top: 0;
            font-size: 1.2em;
        }
        .note-box textarea {
            width: 100%;
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            box-sizing: border-box;
        }
        .dark-mode .note-box textarea {
            background-color: #333;
            border-color: #555;
            color: #e0e0e0;
        }
        /* Slider container */
    .slider {
    display: inline-block;
    position: relative;
    }

    /* Slider switch */
    .slider-label {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
    cursor: pointer;
    }

    .slider-label::before {
    content: "";
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    width: 60px;
    height: 34px;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
    }

    .slider-label::after {
    content: "";
    position: absolute;
    top: 4px;
    left: 4px;
    width: 26px;
    height: 26px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
    }

    /* Checked state */
    .slider:checked + .slider-label::before {
    background-color: #2196F3;
    }

    .slider:checked + .slider-label::after {
    transform: translateX(26px);
    }
    .day {
    cursor: pointer; /* Change cursor to pointer when hovering over dates */
    }
    .day.active-date {
    border: 2px solid red !important; /* Red border for the active date */
    }
    </style>
</head>
<body>
    <header class="big-header">
        <h1>NexTime</h1>
    </header>
    <div class="container">
        <div class="calendar">
            <div class="drag-handle"></div> <!-- Drag Handle for Calendar -->
            <div class="controls">
                <button id="prev">&lt;</button>
                <h2 id="monthYear">August 2024</h2>
                <button id="next">&gt;</button>
            </div>
            <div class="days" id="calendarDays"></div>
        </div>
        <div class="note-box">
            <div class="drag-handle"></div> <!-- Drag Handle for Note Box -->
            <h3 id="noteLabel">7 August Note</h3> <!-- Dynamic Date Label -->
            <textarea id="noteArea" placeholder="Type your notes here..."></textarea>
        </div>
    </div>
    <div class="gear" id="gearIcon"><i class="fas fa-cog"></i></div>
    <div class="settings-panel" id="settingsPanel">
        <span class="close" id="closePanel">&times;</span>
        <h2>Settings</h2>
        <label>
            Dark Theme
            <input type="checkbox" id="themeToggle" class="slider">
            <span class="slider-label"></span>
        </label>
        <label>
            <button id="wipeDataBtn" class="wipe-button">Wipe All Data</button>
        </label>
    </div>
    
    <script>
        document.getElementById('wipeDataBtn').addEventListener('click', () => {
    if (confirm('Are you sure you want to wipe all saved data? This action cannot be undone.')) {
        localStorage.clear(); // Clear all local storage
        location.reload(); // Reload the page to reflect changes
    }
});
    const calendar = document.querySelector('.calendar');
    const noteBox = document.querySelector('.note-box');
    const noteLabel = document.getElementById('noteLabel');
    const noteArea = document.getElementById('noteArea');
    const themeToggle = document.getElementById('themeToggle');
    let isDragging = false;
    let offsetX, offsetY;

    function disableTextSelection() {
        document.body.style.userSelect = 'none'; // Disable text selection
        document.body.style.pointerEvents = 'none'; // Disable mouse events
    }

    function enableTextSelection() {
        document.body.style.userSelect = ''; // Re-enable text selection
        document.body.style.pointerEvents = ''; // Re-enable mouse events
    }

    function addDraggingFunctionality(element) {
        let isDragging = false;
        let offsetX, offsetY;

        const dragHandle = element.querySelector('.drag-handle');
        if (!dragHandle) return; // Ensure drag handle exists

        dragHandle.addEventListener('mousedown', (e) => {
            isDragging = true;
            offsetX = e.clientX - element.getBoundingClientRect().left;
            offsetY = e.clientY - element.getBoundingClientRect().top;
            disableTextSelection(); // Disable text selection
            element.style.position = 'absolute'; // Ensure the element is absolute
            element.style.zIndex = 1000; // Keep it above other elements
        });

        window.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const x = e.clientX - offsetX;
                const y = e.clientY - offsetY;
                element.style.left = `${x}px`;
                element.style.top = `${y}px`;
            }
        });

        window.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                enableTextSelection(); // Re-enable text selection
                element.style.zIndex = ''; // Reset z-index after dragging
                saveCalendarState(); // Save state when dragging stops
            }
        });
    }

    addDraggingFunctionality(calendar);
    addDraggingFunctionality(noteBox);

    const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    let currentMonth = new Date().getMonth(); // Start with current month
    let currentYear = new Date().getFullYear(); // Start with current year
    let selectedDate = localStorage.getItem('selectedDate') || '';

    function loadCalendarState() {
        const savedMonth = localStorage.getItem('calendarMonth');
        const savedYear = localStorage.getItem('calendarYear');
        const savedCalendarPosition = localStorage.getItem('calendarPosition');
        const savedNotePosition = localStorage.getItem('notePosition');
        const savedTheme = localStorage.getItem('theme');

        if (savedMonth !== null) currentMonth = parseInt(savedMonth, 10);
        if (savedYear !== null) currentYear = parseInt(savedYear, 10);
        if (savedTheme === 'dark') document.body.classList.add('dark-mode');
        if (savedCalendarPosition) calendar.style.left = savedCalendarPosition.split(',')[0];
        if (savedCalendarPosition) calendar.style.top = savedCalendarPosition.split(',')[1];
        if (savedNotePosition) noteBox.style.left = savedNotePosition.split(',')[0];
        if (savedNotePosition) noteBox.style.top = savedNotePosition.split(',')[1];

        renderCalendar(currentMonth, currentYear);
        // Set the theme toggle based on saved theme
        if (savedTheme === 'dark') themeToggle.checked = true;
        loadNote(); // Load the note for the selected date
    }

    function saveCalendarState() {
        localStorage.setItem('calendarMonth', currentMonth);
        localStorage.setItem('calendarYear', currentYear);
        localStorage.setItem('calendarPosition', `${calendar.style.left},${calendar.style.top}`);
        localStorage.setItem('notePosition', `${noteBox.style.left},${noteBox.style.top}`);
        const isDarkMode = document.body.classList.contains('dark-mode');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    }

    function saveNote() {
        if (selectedDate) {
            localStorage.setItem(`note-${selectedDate}`, noteArea.value);
        }
    }

    function loadNote() {
        if (selectedDate) {
            noteArea.value = localStorage.getItem(`note-${selectedDate}`) || '';
        }
    }

    function renderCalendar(month, year) {
        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();
        const daysContainer = document.getElementById('calendarDays');
        const monthYear = document.getElementById('monthYear');

        daysContainer.innerHTML = '';

        const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        daysOfWeek.forEach((day, index) => {
            const div = document.createElement('div');
            div.className = `day day-header ${day.toLowerCase()}`;
            div.textContent = day;
            daysContainer.appendChild(div);
        });

        for (let i = 0; i < firstDay; i++) {
            daysContainer.appendChild(document.createElement('div'));
        }

        for (let i = 1; i <= lastDate; i++) {
            const div = document.createElement('div');
            div.className = 'day';
            div.textContent = i;

            div.addEventListener('click', () => {
                const dateLabel = `${i} ${monthNames[month]} Note`;
                noteLabel.textContent = dateLabel;
                noteArea.value = ''; // Clear the note area

                // Remove 'active-date' class from all days
                document.querySelectorAll('.day').forEach(day => day.classList.remove('active-date'));

                // Add 'active-date' class to clicked day
                div.classList.add('active-date');

                // Save the selected date to localStorage
                selectedDate = `${i}-${month}-${year}`;
                localStorage.setItem('selectedDate', selectedDate);
                loadNote(); // Load the note for the selected date
            });
            
            // Check if this day is the selected date
            if (`${i}-${month}-${year}` === selectedDate) {
                div.classList.add('active-date');
            }
            if (i === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear()) {
                div.classList.add('current-date'); // Highlight today's date
            }
            daysContainer.appendChild(div);
        }
        
        monthYear.textContent = `${monthNames[month]} ${year}`;
        saveCalendarState(); // Save state after rendering
    }

    document.getElementById('prev').addEventListener('click', () => {
        if (currentMonth === 0) {
            currentMonth = 11;
            currentYear--;
        } else {
            currentMonth--;
        }
        renderCalendar(currentMonth, currentYear);
    });

    document.getElementById('next').addEventListener('click', () => {
        if (currentMonth === 11) {
            currentMonth = 0;
            currentYear++;
        } else {
            currentMonth++;
        }
        renderCalendar(currentMonth, currentYear);
    });

    document.getElementById('gearIcon').addEventListener('click', () => {
        document.getElementById('settingsPanel').classList.add('active');
    });

    document.getElementById('closePanel').addEventListener('click', () => {
        document.getElementById('settingsPanel').classList.remove('active');
    });

    themeToggle.addEventListener('change', (event) => {
        if (event.target.checked) {
            document.body.classList.add('dark-mode');
        } else {
            document.body.classList.remove('dark-mode');
        }
        saveCalendarState(); // Save state when theme changes
    });

    noteArea.addEventListener('input', () => {
        saveNote(); // Save note content as it changes
    });

    window.addEventListener('beforeunload', saveNote);
 
        document.getElementById('themeToggle').addEventListener('change', (event) => {
            if (event.target.checked) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            saveCalendarState(); // Save state when theme changes
        });

        // Load state when page loads
        loadCalendarState();
    </script>
</body>
</html>
